# ๐ง ุฅุตูุงุญ ูุดููุฉ ูุฏูุฑ ุงููุฑุน - ุชุญุฏูุฏ ุงููุฑุน ุงูุชููุงุฆู

## ๐ ุงููุดููุฉ ุงูุณุงุจูุฉ:
ุนูุฏ ุชุณุฌูู ุฏุฎูู ูุฏูุฑ ูุฑุน (ูุซู: ูุฏูุฑ ูุฑุน ุงูุฑุณ)ุ ูุงูุช ุฌููุน ุงููุฑูุน ุชุธูุฑ ูู ุตูุญุฉ ุฅุถุงูุฉ ุทูุจ ุชุฑููุจุ ููู ูุชู ุชุญุฏูุฏ ูุฑุนู ุชููุงุฆูุงู.

## ๐ ุงูุณุจุจ ุงูุฌุฐุฑู:
ุนูุฏ ุฅูุดุงุก ูุณุชุฎุฏู "ูุฏูุฑ ูุฑุน" ูู ุตูุญุฉ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู:
- โ ูุงู ูุชู ุญูุธ `branchId` ููุท
- โ ูู ูุชู ุญูุธ `branchName`
- โ ุนูุฏ ุชุณุฌูู ุงูุฏุฎููุ ูุง ูุชู ุชุญููู `branchName` ุฅูู localStorage
- โ ุตูุญุฉ ุฅุถุงูุฉ ุงูุทูุจ ูุง ุชุฌุฏ `branchName` ููุง ุชููู ุจุงูุชุญุฏูุฏ ุงูุชููุงุฆู

---

## โ ุงูุญู ุงููุทุจู:

### 1. ุชุญุฏูุซ ูุงุฌูุฉ `User` ูู `UsersManagement.tsx`:
```typescript
interface User {
  id?: string;
  username: string;
  fullName: string;
  password: string;
  position: 'ูุฏูุฑ ุนุงู' | 'ูุดุฑู ุชุฑููุจ' | 'ููู' | 'ูุฏูุฑ ูุฑุน';
  accessType?: 'installation' | 'installation_delivery';
  permissions: string[];
  branchId?: string;
  branchName?: string;  // โจ ุชู ุฅุถุงูุชู
  createdAt?: Date | { toDate: () => Date };
  updatedAt?: Date | { toDate: () => Date };
}
```

### 2. ุชุญุฏูุซ ุฏุงูุฉ ุงูุญูุธ ูุญูุธ ุงุณู ุงููุฑุน:
```typescript
// ุฅุถุงูุฉ ูุนุฑู ุงููุฑุน ูุงุณู ุงููุฑุน ุฅุฐุง ูุงู ูุฏูุฑ ูุฑุน
if (values.position === 'ูุฏูุฑ ูุฑุน' && values.branchId) {
  userData.branchId = values.branchId;
  // ุฅุถุงูุฉ ุงุณู ุงููุฑุน ุฃูุถุงู โจ
  const selectedBranch = branches.find(b => b.id === values.branchId);
  if (selectedBranch) {
    userData.branchName = selectedBranch.name;
  }
}
```

### 3. ุชุญุฏูุซ localStorage ุนูุฏ ุงูุชุนุฏูู:
```typescript
const updatedUser = {
  id: editingUser.id,
  username: userData.username,
  fullName: userData.fullName,
  position: userData.position,
  branchId: userData.branchId,
  branchName: userData.branchName,  // โจ ุชู ุฅุถุงูุชู
  permissions: userData.permissions,
  accessType: userData.accessType,
  userType: 'installation',
  financialYearId: currentFinancialYear.id
};
```

### 4. ุชุญุฏูุซ ุนุฑุถ ุงููุฑุน ูู ุงูุฌุฏูู:
```typescript
render: (_: unknown, record: User) => {
  if (!record.branchId) return '-';
  // ุฃููุงู: ุงุณุชุฎุฏุงู branchName ุงููุญููุธ โจ
  if (record.branchName) return record.branchName;
  // ุซุงููุงู: ุงูุจุญุซ ูู ูุงุฆูุฉ ุงููุฑูุน
  const branch = branches.find(b => b.id === record.branchId);
  return branch ? branch.name : record.branchId;
}
```

### 5. ุตูุญุฉ ุฅุถุงูุฉ ุงูุทูุจ `add-order.tsx`:
```typescript
// ุชุญููู ุจูุงูุงุช ุงููุณุชุฎุฏู ุงูุญุงูู ูู localStorage
useEffect(() => {
  const storedUser = localStorage.getItem('currentUser');
  if (storedUser) {
    try {
      const user = JSON.parse(storedUser);
      setCurrentUser(user);
      
      // ุฅุฐุง ูุงู ูุฏูุฑ ูุฑุนุ ุชุนููู ุงููุฑุน ุชููุงุฆูุงู โ
      if (user.position === 'ูุฏูุฑ ูุฑุน' && user.branchId) {
        if (user.branchName) {
          setResponsibleEntity(user.branchName);
        }
        console.log('๐ช Auto-selected branch:', user.branchName);
      }
    } catch (error) {
      console.error('Error parsing user:', error);
    }
  }
}, []);
```

```tsx
<Select
  value={responsibleEntity || undefined}
  onChange={setResponsibleEntity}
  placeholder="ุงุฎุชุฑ ุงููุฑุน"
  disabled={currentUser?.position === 'ูุฏูุฑ ูุฑุน' && currentUser?.branchName !== undefined}
  // โ ูุชู ุชุนุทูู ุงูุญูู ููุฏูุฑ ุงููุฑุน โ
>
  {branches.map(branch => (
    <Option key={branch.id} value={branch.name}>
      {branch.name}
    </Option>
  ))}
</Select>
{currentUser?.position === 'ูุฏูุฑ ูุฑุน' && currentUser?.branchName && (
  <span className="text-xs text-gray-500 mt-1">
    ๐ ุงููุฑุน ูุญุฏุฏ ุชููุงุฆูุงู ุญุณุจ ุตูุงุญูุงุชู
  </span>
)}
```

---

## ๐งช ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ:

### โ ููู: ุงููุณุชุฎุฏููู ุงูุญุงูููู ูุญุชุงุฌูู ุชุญุฏูุซ

**ุงููุณุชุฎุฏููู ุงูุฐูู ุชู ุฅูุดุงุคูู ูุจู ูุฐุง ุงูุฅุตูุงุญ ูุง ูููููู `branchName` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช!**

### ุงูุญู ุงูุณุฑูุน: ุชุญุฏูุซ ุงููุณุชุฎุฏููู ุงูุญุงูููู

#### ุงูุฎูุงุฑ 1: ูู ุฎูุงู ูุงุฌูุฉ ุงููุธุงู (ุงูุฃุณูู) โญ
1. **ุณุฌู ุฏุฎูู ุจุญุณุงุจ ูุฏูู ุตูุงุญูุงุช**
2. **ุงุฐูุจ ุฅูู:** `/installation/users` (ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู)
3. **ููู ูุฏูุฑ ูุฑุน:**
   - ุงุถุบุท ุฒุฑ "ุชุนุฏูู" โ๏ธ
   - ุฃุนุฏ ุงุฎุชูุงุฑ ุงููุฑุน ูู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ
   - ุงุญูุธ ุงูุชุบููุฑุงุช
4. **ุงูุขู `branchName` ูุญููุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช!**

#### ุงูุฎูุงุฑ 2: ูู Firebase Console
1. **ุงูุชุญ Firestore Database**
2. **ุงูุชูู ุฅูู:**
   ```
   financialYears/{yearId}/installation_users
   ```
3. **ููู ูุณุชุฎุฏู ูู ููุน "ูุฏูุฑ ูุฑุน":**
   - ุงูุชุญ ุงููุณุชูุฏ
   - ุฃุถู ุญูู ุฌุฏูุฏ:
     ```
     Field: branchName
     Type: string
     Value: ุงูุฑุณ  (ุฃู ุงุณู ุงููุฑุน ุงูููุงุณุจ)
     ```
   - ุงุญูุธ

---

## ๐ ูุซุงู ุนููู:

### ูุจู ุงูุฅุตูุงุญ โ:
```json
{
  "id": "user123",
  "username": "alrass_manager",
  "fullName": "ุฃุญูุฏ ูุญูุฏ - ูุฏูุฑ ุงูุฑุณ",
  "position": "ูุฏูุฑ ูุฑุน",
  "branchId": "branch_alrass_id"
  // โ ูุง ููุฌุฏ branchName
}
```

**ุงููุชูุฌุฉ:** ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู ููุชุญ ุตูุญุฉ ุฅุถุงูุฉ ุทูุจ:
- โ ุฌููุน ุงููุฑูุน ุชุธูุฑ
- โ ูุง ูุชู ุงูุชุญุฏูุฏ ุงูุชููุงุฆู
- โ ูููู ุชุบููุฑ ุงููุฑุน

---

### ุจุนุฏ ุงูุฅุตูุงุญ โ:
```json
{
  "id": "user123",
  "username": "alrass_manager",
  "fullName": "ุฃุญูุฏ ูุญูุฏ - ูุฏูุฑ ุงูุฑุณ",
  "position": "ูุฏูุฑ ูุฑุน",
  "branchId": "branch_alrass_id",
  "branchName": "ุงูุฑุณ"  // โ ุชู ุฅุถุงูุชู
}
```

**ุงููุชูุฌุฉ:** ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู ููุชุญ ุตูุญุฉ ุฅุถุงูุฉ ุทูุจ:
- โ ูุฑุน "ุงูุฑุณ" ูุญุฏุฏ ุชููุงุฆูุงู
- โ ุงูุญูู ูุนุทูู (disabled)
- โ ุฑุณุงูุฉ: "๐ ุงููุฑุน ูุญุฏุฏ ุชููุงุฆูุงู ุญุณุจ ุตูุงุญูุงุชู"
- โ ูุง ูููู ุชุบููุฑ ุงููุฑุน

---

## ๐ฏ ุงูุชุทุจูู ุนูู ูุณุชุฎุฏูู ุงูุชูุตูู:

**ููุณ ุงูููุทู ูุทุจู ุนูู ูุณุชุฎุฏูู ุงูุชูุตูู ุฃูุถุงู!**

ูุฌุจ ุชุญุฏูุซ ุตูุญุฉ ุฅุฏุงุฑุฉ ูุณุชุฎุฏูู ุงูุชูุตูู (`delivery/users`) ุจููุณ ุงูุทุฑููุฉ:
1. ุฅุถุงูุฉ `branchName` ุฅูู ูุงุฌูุฉ User
2. ุญูุธ `branchName` ุนูุฏ ุงุฎุชูุงุฑ ุงููุฑุน
3. ุชุญุฏูุซ localStorage

---

## ๐ ููุงุญุธุงุช ูููุฉ:

### 1. ุงููุณุชุฎุฏููู ุงูุฌุฏุฏ:
- โ ุณูุนูู ุงููุธุงู ุจุดูู ุตุญูุญ ุชููุงุฆูุงู
- โ ุณูุชู ุญูุธ `branchId` ู `branchName` ูุนุงู

### 2. ุงููุณุชุฎุฏููู ุงูุญุงูููู:
- โ๏ธ ูุญุชุงุฌูู ุชุญุฏูุซ ูุฏูู (ูุฑุฉ ูุงุญุฏุฉ ููุท)
- โ๏ธ ุจุนุฏ ุงูุชุญุฏูุซุ ุณูุนูู ูู ุดูุก ุจุดูู ุตุญูุญ

### 3. ุชุณุฌูู ุงูุฏุฎูู:
ุนูุฏ ุชุณุฌูู ุฏุฎูู ูุฏูุฑ ูุฑุนุ ูุชู ุชุญููู:
```javascript
{
  id: "user_id",
  username: "alrass_manager",
  fullName: "ุฃุญูุฏ ูุญูุฏ",
  position: "ูุฏูุฑ ูุฑุน",
  branchId: "branch_id",
  branchName: "ุงูุฑุณ",  // โจ ููู!
  userType: "installation",
  financialYearId: "year_id"
}
```

### 4. ุตูุญุฉ ุฅุถุงูุฉ ุงูุทูุจ:
```javascript
// ูุชู ูุญุต:
if (user.position === 'ูุฏูุฑ ูุฑุน' && user.branchName) {
  setResponsibleEntity(user.branchName);  // ุชุญุฏูุฏ ุชููุงุฆู โ
}

// ุชุนุทูู ุงูุญูู:
disabled={currentUser?.position === 'ูุฏูุฑ ูุฑุน' && currentUser?.branchName !== undefined}
```

---

## โ ูุงุฆูุฉ ุงูุชุญูู ุงูููุงุฆูุฉ:

### ูุชุทุจูู ุงูุฅุตูุงุญ ุนูู ูุณุชุฎุฏู ููุฌูุฏ:

- [ ] 1. ุณุฌู ุฏุฎูู ุจุญุณุงุจ ุฅุฏุงุฑู
- [ ] 2. ุงุฐูุจ ุฅูู `/installation/users`
- [ ] 3. ุงุจุญุซ ุนู ูุฏูุฑ ุงููุฑุน (ูุซุงู: "ูุฏูุฑ ูุฑุน ุงูุฑุณ")
- [ ] 4. ุงุถุบุท "ุชุนุฏูู" โ๏ธ
- [ ] 5. ุฃุนุฏ ุงุฎุชูุงุฑ ุงููุฑุน ูู ุงููุงุฆูุฉ
- [ ] 6. ุงุญูุธ ุงูุชุบููุฑุงุช โ
- [ ] 7. **ุณุฌู ุฎุฑูุฌ** ูู ุญุณุงุจ ูุฏูุฑ ุงููุฑุน
- [ ] 8. **ุณุฌู ุฏุฎูู ูุฑุฉ ุฃุฎุฑู** ุจุญุณุงุจ ูุฏูุฑ ุงููุฑุน
- [ ] 9. ุงุฐูุจ ุฅูู `/installation/add-order`
- [ ] 10. **ุชุฃูุฏ ูู:**
     - โ ุงููุฑุน ูุญุฏุฏ ุชููุงุฆูุงู
     - โ ุงูุญูู ูุนุทูู (ุฑูุงุฏู)
     - โ ุฑุณุงูุฉ "๐ ุงููุฑุน ูุญุฏุฏ ุชููุงุฆูุงู" ุชุธูุฑ

---

## ๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:

**ุงูุขู:**
- โ ูุฏูุฑ ูุฑุน ุงูุฑุณ ุณูุฑู ููุท ูุฑุน "ุงูุฑุณ" ูุญุฏุฏุงู ุชููุงุฆูุงู
- โ ูู ูุณุชุทูุน ุชุบููุฑ ุงููุฑุน
- โ ุงููุธุงู ูุนูู ุจุดูู ุขูู ูููุธู
- โ ูู ูุฏูุฑ ูุฑุน ูุนูู ููุท ุนูู ูุฑุนู

---

**ุขุฎุฑ ุชุญุฏูุซ:** 15 ููููุจุฑ 2025  
**ุงูุญุงูุฉ:** โ ุชู ุงูุฅุตูุงุญ ุจูุฌุงุญ
