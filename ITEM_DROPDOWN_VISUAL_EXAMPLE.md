# مثال بصري للقائمة المنسدلة المحسّنة

## القائمة المنسدلة القديمة (Before)
```
┌─────────────────────────────────────┐
│ اسم الصنف                ▼        │
├─────────────────────────────────────┤
│ لابتوب HP ProBook                 │
│ كود: LP-001                        │
│ السعر: 2500 ر.س                   │
├─────────────────────────────────────┤
│ ماوس لوجيتك                       │
│ كود: MS-005                        │
│ السعر: 50 ر.س                     │
├─────────────────────────────────────┤
│ كيبورد قديم (إيقاف مؤقت)          │
│ كود: KB-OLD                        │
│ السعر: 100 ر.س                    │
└─────────────────────────────────────┘
```

## القائمة المنسدلة الجديدة (After)
```
┌──────────────────────────────────────────────────────────────┐
│ اسم الصنف                ▼  [جاري تحميل الأرصدة...]       │
├──────────────────────────────────────────────────────────────┤
│ لابتوب HP ProBook          [🟢 متوفر]                      │
│ كود: LP-001  │  السعر: 2500 ر.س  │  الرصيد: 15.00          │
├──────────────────────────────────────────────────────────────┤
│ طابعة Canon               [🟡 كمية قليلة]                  │
│ كود: PR-003  │  السعر: 800 ر.س   │  الرصيد: 5.00           │
├──────────────────────────────────────────────────────────────┤
│ ماوس لوجيتك               [🔴 نفذ من المخزون]             │
│ كود: MS-005  │  السعر: 50 ر.س    │  الرصيد: 0.00           │
├──────────────────────────────────────────────────────────────┤
│ كيبورد قديم               [🔴 موقوف مؤقتاً]               │
│ كود: KB-OLD  │  السعر: 100 ر.س                             │
├──────────────────────────────────────────────────────────────┤
│ هاردسك خارجي              [🔴 رصيد سالب]                   │
│ كود: HD-008  │  السعر: 300 ر.س   │  الرصيد: -2.00          │
└──────────────────────────────────────────────────────────────┘
```

## الألوان والمؤشرات

### 🟢 متوفر (Available)
- **اللون:** أخضر (#52c41a)
- **الشرط:** الرصيد > 10
- **المعنى:** الصنف متوفر بكميات جيدة

### 🟡 كمية قليلة (Low Stock)
- **اللون:** برتقالي (#faad14)
- **الشرط:** 0 < الرصيد ≤ 10
- **المعنى:** الصنف متوفر لكن الكمية قليلة، يُنصح بإعادة الطلب

### 🔴 نفذ من المخزون (Out of Stock)
- **اللون:** أحمر (#ff4d4f)
- **الشرط:** الرصيد = 0
- **المعنى:** الصنف غير متوفر حالياً

### 🔴 رصيد سالب (Negative Stock)
- **اللون:** أحمر داكن (#cf1322)
- **الشرط:** الرصيد < 0
- **المعنى:** تم بيع أكثر من المشتريات (يحتاج تدقيق)

### 🔴 موقوف مؤقتاً (Temporarily Suspended)
- **اللون:** أحمر (#ff4d4f)
- **الشرط:** tempCodes = true
- **المعنى:** الصنف موقوف ولا يمكن بيعه حالياً

### ⚪ اختر المخزن أولاً (Select Warehouse First)
- **اللون:** رمادي (#999)
- **الشرط:** لم يتم اختيار مخزن
- **المعنى:** يجب اختيار المخزن أولاً لعرض الرصيد

## مثال تفاعلي

### السيناريو 1: اختيار صنف متوفر
```
[المستخدم يختار "لابتوب HP ProBook"]

✅ تم تحديد الصنف: لابتوب HP ProBook
   - الكود: LP-001
   - السعر: 2500 ر.س
   - الرصيد المتاح: 15.00
   - الحالة: متوفر ✓
```

### السيناريو 2: محاولة اختيار صنف موقوف
```
[المستخدم يحاول اختيار "كيبورد قديم"]

⚠️ تم إيقاف الصنف "كيبورد قديم" مؤقتاً ولا يمكن إضافته للفاتورة
```

### السيناريو 3: التبديل بين المخازن
```
[المستخدم في صفحة إضافة فاتورة مبيعات]

المخزن: [المخزن الرئيسي ▼]

الأصناف المتوفرة:
- لابتوب HP ProBook: 15 قطعة
- ماوس لوجيتك: 0 قطعة
- طابعة Canon: 5 قطع

[المستخدم يغير المخزن إلى "مخزن الفرع الشرقي"]

🔄 جاري تحديث الأرصدة...

الأصناف المتوفرة:
- لابتوب HP ProBook: 8 قطع
- ماوس لوجيتك: 12 قطعة
- طابعة Canon: 0 قطعة
```

## مميزات إضافية

### 1. البحث الذكي
يمكن البحث بـ:
- اسم الصنف (عربي)
- كود الصنف (SKU)

### 2. الترتيب
الأصناف مرتبة حسب:
1. الأصناف النشطة أولاً
2. ثم الأصناف الموقوفة (معطلة)

### 3. التصفية التلقائية
- لا تظهر إلا الأصناف من النوع "مستوى ثاني"
- الأصناف بدون اسم يتم تجاهلها
- كل صنف يظهر مرة واحدة فقط (بدون تكرار)

### 4. التحديث التلقائي
- عند تغيير المخزن الرئيسي ← تحديث جميع الأرصدة
- عند تغيير مخزن الصنف (مخازن متعددة) ← تحديث رصيد الصنف فقط

## رسم توضيحي لتدفق البيانات

```
┌─────────────────┐
│  المستخدم      │
│  يختار المخزن  │
└────────┬────────┘
         │
         ↓
┌────────────────────────────┐
│  جلب فواتير المشتريات    │ ← الوارد
│  + مرتجعات المبيعات       │
└────────┬───────────────────┘
         │
         ↓
┌────────────────────────────┐
│  جلب فواتير المبيعات     │ ← المنصرف
└────────┬───────────────────┘
         │
         ↓
┌────────────────────────────┐
│  حساب الرصيد              │
│  = الوارد - المنصرف       │
└────────┬───────────────────┘
         │
         ↓
┌────────────────────────────┐
│  تحديث القائمة المنسدلة   │
│  مع الأرصدة والحالات     │
└────────────────────────────┘
```

## ملاحظات مهمة

1. **الأداء**: يتم حساب الأرصدة مرة واحدة عند اختيار المخزن، وليس عند كل ضغطة على القائمة
2. **الدقة**: الأرصدة محسوبة في الوقت الفعلي من قاعدة البيانات
3. **التوافق**: يعمل مع وضع المخزن الواحد والمخازن المتعددة
4. **الأمان**: الأصناف الموقوفة معطلة ولا يمكن اختيارها

---

تم إنشاء هذا المستند بواسطة: GitHub Copilot
التاريخ: 5 أكتوبر 2025
